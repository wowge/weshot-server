webpackJsonp([1],{"/8vw":function(t,a,e){"use strict";var i=e("MkCj"),n=e("7+uW"),s=e("ORbq"),o=e("NHnr");n.a.use(s.a),a.a={login:function(t,a){if(""===a.nickName||""===a.password)return void t.commit(i.b,"不允许为空");n.a.http.post(t.state.domain+"/vue/login",{nickName:a.nickName,password:a.password}).then(function(t){return t.json()}).then(function(t){window.localStorage["weshot-token"]=t.token,o.app.$router.push("/albumsList")}).catch(function(a){"incorrect user"===a.body.msg?t.commit(i.b,"用户名错误"):"incorrect password"===a.body.msg&&t.commit(i.b,"密码错误")})},getAlbumsList:function(t,a){var e=window.localStorage["weshot-token"],s=JSON.parse(window.atob(e.split(".")[1])),o=s._id,r={},c=[];n.a.http.get(t.state.domain+"/vue/user?id="+o).then(function(t){return t.json()}).then(function(e){t.commit(i.a,e),r=e,t.commit(i.e,r.nickName+"的相册");for(var s=0,o=0,u=0;u<r.history.length;u++)!function(e){n.a.http.get(t.state.domain+"/vue/album?id="+r.history[e]).then(function(a){return o++,c[e]={id:r.history[e],cover:a.data.photos[0],title:a.data.albumName,author:a.data.userInfo.open_id,createOn:new Date(a.data.createOn)},n.a.http.get(t.state.domain+"/api/downloadUrl?key="+c[e].cover)}).then(function(a){return c[e].cover=a.data.downloadUrl,n.a.http.get(t.state.domain+"/vue/user?id="+c[e].author)}).then(function(n){c[e].author={nickName:n.data.nickName,avatar:n.data.avatarUrl},++s===o&&(t.commit(i.c,c),a.listReady=!0)})}(u)}).catch(function(t){console.log(t)})},getAlbum:function(t,a){var e={};n.a.http.get(t.state.domain+"/vue/album?id="+a.$route.query.id).then(function(a){return e={photos:a.data.photos,albumName:a.data.albumName,memory:a.data.memory,feelings:a.data.feelings,music:a.data.music,userInfo:a.data.userInfo,createOn:new Date(a.data.createOn)},t.commit(i.e,e.albumName),n.a.http.get(t.state.domain+"/api/get/song/qq?id="+e.music.id)}).then(function(a){return e.music.src=a.data.url,n.a.http.get(t.state.domain+"/vue/user?id="+e.userInfo.open_id)}).then(function(s){e.userInfo.nickName=s.data.nickName,e.userInfo.avatar=s.data.avatarUrl;for(var o=0,r=0,c=0;c<e.photos.length;c++)!function(s){r++,n.a.http.get(t.state.domain+"/api/downloadUrl?key="+e.photos[s]).then(function(n){e.photos[s]=n.data.downloadUrl,++o===r&&(t.commit(i.d,e),a.albumReady=!0)})}(c)}).catch(function(t){console.log(t)})}}},0:function(t,a){},"12qG":function(t,a){},"1rsT":function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement;return(t._self._c||a)("div",{staticClass:"aplayer"})},n=[],s={render:i,staticRenderFns:n};a.a=s},"4aQm":function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[t.albumReady?t._e():e("div",{staticClass:"row well"},[e("span",[t._v("正在读取中...")])]),t.albumReady?e("div",{staticClass:"row"},[e("div",{staticClass:"col-xs-12"},[e("VueAplayer",{attrs:{music:{title:t.album.music.name,author:t.album.music.authors,url:t.album.music.src,pic:t.album.music.poster}}}),e("br"),e("br"),e("div",{staticClass:"list-group"},[t._l(t.album.photos,function(a,i){return[e("div",{staticClass:"col-xs-12 col-md-6"},[e("div",{staticClass:"list-group-item well"},[e("div",{staticClass:"list-group-item-heading"},[t._v(t._s(t.album.feelings[i]))]),e("a",{attrs:{target:"_blank",href:a,rel:"noopener"}},[e("img",{staticClass:"img-responsive img-thumbnail",attrs:{src:a}})])])])]})],2)],1)]):t._e(),e("br"),e("br"),t.albumReady?e("div",{staticClass:"row"},[e("div",{staticClass:"panel panel-info"},[t._m(0),e("div",{staticClass:"panel-body"},[t._v(t._s(t.album.memory))]),e("div",{staticClass:"right",staticStyle:{"font-size":"20px"}},[t._v(t._s(t.album.userInfo.nickName)),e("img",{staticClass:"img-circle",staticStyle:{width:"10%",height:"10%"},attrs:{src:t.album.userInfo.avatar}}),e("p",[t._v(t._s(t._f("date")(t.album.createOn)))])])])]):t._e()])},n=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"panel-heading"},[e("div",{staticClass:"panel-title"},[t._v("寄语")])])}],s={render:i,staticRenderFns:n};a.a=s},"6LXs":function(t,a,e){"use strict";function i(t){e("LuhD")}var n=e("isYl"),s=e("fA53"),o=e("VU/8"),r=i,c=o(n.a,s.a,r,"data-v-c8c71d20",null);a.a=c.exports},CUGf:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container common",attrs:{id:"app"}},[e("h1",[t._v(t._s(t.title))]),t.isLoggedIn()?e("div",{staticClass:"right",on:{mouseover:function(a){t.showAlert()},mouseout:function(a){t.clearAlert()}}},[t._v(t._s(t.user.nickName)),e("button",{on:{click:function(a){t.logout()}}},[t._v("登出"),e("i",{staticClass:"glyphicon glyphicon-log-out"})]),t.alert?e("div",{staticClass:"alert alert-danger"},[t._v("在公用电脑上登录请记得登出，防止隐私泄漏")]):t._e()]):t._e(),t.isLoggedIn()||t.isLoginPath()?t._e():e("div",{staticClass:"right"},[e("button",{on:{click:function(a){t.gotoLogin()}}},[t._v("登录"),e("i",{staticClass:"glyphicon glyphicon-log-in"})])]),e("hr"),e("router-view",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.title,expression:"title"}]})],1)},n=[],s={render:i,staticRenderFns:n};a.a=s},HPoU:function(t,a,e){"use strict";var i=e("RvFq"),n=e.n(i);a.a={props:{narrow:{type:Boolean,default:!1},autoplay:{type:Boolean,default:!1},showlrc:{type:Number,default:0},mutex:{type:Boolean,default:!1},theme:{type:String,default:"#b7daff"},mode:{type:String,default:"circulation"},preload:{type:String,default:"auto"},listmaxheight:String,music:{type:[Object,Array],required:!0,validator:function(t){var a=void 0;a=t instanceof Array?t:[t];for(var e=0;e<a.length;e++){var i=a[e];if(!i.url||!i.title||!i.author)return i.title=i.title||"Untitled",i.author=i.author||"Unknown",!1}return!0}}},data:function(){return{control:null}},watch:{music:function(t){this.control.option.music=t,this.control.setMusic(0),this.autoplay&&this.control.play(),this.$emit("change",t)}},mounted:function(){var t=this,a=this.control=new n.a({element:this.$el,narrow:this.narrow,autoplay:this.autoplay,showlrc:this.showlrc,mutex:this.mutex,theme:this.theme,preload:this.preload,mode:this.mode,listmaxheight:this.listmaxheight,music:this.music});a.on("play",function(){t.$emit("play")}),a.on("pause",function(){t.$emit("pause")}),a.on("canplay",function(){t.$emit("canplay")}),a.on("playing",function(){t.$emit("playing")}),a.on("ended",function(){t.$emit("ended")}),a.on("error",function(){t.$emit("error")})}}},LuhD:function(t,a){},M93x:function(t,a,e){"use strict";function i(t){e("zUKl")}var n=e("xJD8"),s=e("CUGf"),o=e("VU/8"),r=i,c=o(n.a,s.a,r,null,null);a.a=c.exports},MkCj:function(t,a,e){"use strict";e.d(a,"a",function(){return i}),e.d(a,"b",function(){return n}),e.d(a,"c",function(){return s}),e.d(a,"d",function(){return o}),e.d(a,"e",function(){return r});var i="UPDATE_USERINFO",n="SET_LOGINERR",s="UPDATE_ALBUMSLIST",o="UPDATE_ALBUM",r="UPDATE_TITLE"},NHnr:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),e.d(a,"app",function(){return o});var i=e("7+uW"),n=e("M93x"),s=e("YaEn");i.a.config.productionTip=!1,i.a.filter("date",function(t){var a=t.getFullYear(),e=t.getMonth()+1,i=t.getDate();return a.toString()+"年"+e.toString()+"月"+i.toString()+"日"}),i.a.use(e("YqKu"));var o=new i.a({el:"app",router:s.a,components:{App:n.a},watch:{$route:"route"},created:function(){this.route()},methods:{isLoggedIn:function(){var t=window.localStorage["weshot-token"];if(t){var a=JSON.parse(window.atob(t.split(".")[1]));return Date.now()/1e3<a.exp}return!1},route:function(){this.isLoggedIn()||"/album"===this.$route.path?this.isLoggedIn()&&"/album"!==this.$route.path?this.$router.push("/albumsList"):this.$router.push(this.$route.fullPath):this.$router.push("/login")}}})},"UTg/":function(t,a,e){"use strict";var i,n=e("bOdI"),s=e.n(n),o=e("MkCj");a.a=(i={},s()(i,o.a,function(t,a){t.user=a}),s()(i,o.b,function(t,a){t.loginErr=a}),s()(i,o.c,function(t,a){t.albumsList=a}),s()(i,o.d,function(t,a){t.album=a}),s()(i,o.e,function(t,a){t.title=a}),i)},WMeU:function(t,a,e){"use strict";a.a={getUser:function(t){return t.user},getLoginErr:function(t){return t.loginErr},getList:function(t){return t.albumsList},getAlbumItem:function(t){return t.album},getTitle:function(t){return t.title}}},YaEn:function(t,a,e){"use strict";var i=e("7+uW"),n=e("/ocq"),s=e("xJsL"),o=e("6LXs"),r=e("gOGN");i.a.use(n.a),a.a=new n.a({routes:[{path:"/login",name:"Login",component:s.a},{path:"/albumsList",name:"AlbumsList",component:o.a},{path:"/album",name:"Album",component:r.a}]})},YtJ0:function(t,a,e){"use strict";var i=e("7+uW"),n=e("NYxO"),s=e("WMeU"),o=e("UTg/"),r=e("/8vw");i.a.use(n.c);var c={domain:"https://weshot.wowge.org",user:{},loginErr:"",albumsList:[],album:{},title:"似水流年小相册"};a.a=new n.c.Store({state:c,actions:r.a,mutations:o.a,getters:s.a})},afmS:function(t,a,e){"use strict";var i=e("HPoU"),n=e("1rsT"),s=e("VU/8"),o=s(i.a,n.a,null,null,null);a.a=o.exports},fA53:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[t.listReady?t._e():e("div",{staticClass:"row well"},[e("span",[t._v("正在读取中...")])]),e("br"),t.listReady?e("div",{staticClass:"row"},[e("div",{staticClass:"col-xs-12"},[e("div",{staticClass:"list-group"},[t._l(t.albumsList,function(a){return void 0!==a?[e("div",{staticClass:"col-xs-12 col-md-6"},[e("div",{staticClass:"list-group-item well"},[e("img",{staticClass:"img-thumbnail img-responsive",attrs:{src:a.cover}}),e("p",[t._v(t._s(a.title))]),e("div",{staticClass:"right"},[e("a",{on:{click:function(e){t.gotoAlbum(a.id)}}},[e("i",{staticClass:"glyphicon glyphicon-chevron-right"}),e("i",{staticClass:"glyphicon glyphicon-chevron-right"})])]),e("hr"),e("div",{staticClass:"right"},[t._v(t._s(a.author.nickName)),e("img",{staticClass:"img-circle",staticStyle:{width:"10%",height:"10%"},attrs:{src:a.author.avatar}}),e("p",[t._v(t._s(t._f("date")(a.createOn)))])])])])]:t._e()})],2)])]):t._e()])},n=[],s={render:i,staticRenderFns:n};a.a=s},gBXN:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[e("form",{staticClass:"form-horizontal",attrs:{id:"login"}},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"col-xs-12 col-sm-2 control-label",attrs:{for:"nickName"}},[t._v("用户名")]),e("div",{staticClass:"col-xs-12 col-sm-10"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.credential.nickName,expression:"credential.nickName"}],staticClass:"form-control",attrs:{id:"nickName",name:"nickName",type:"text"},domProps:{value:t.credential.nickName},on:{input:function(a){a.target.composing||(t.credential.nickName=a.target.value)}}})])]),e("div",{staticClass:"form-group"},[e("label",{staticClass:"col-xs-12 col-sm-2 control-label",attrs:{for:"password"}},[t._v("密码")]),e("div",{staticClass:"col-xs-12 col-sm-10"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.credential.password,expression:"credential.password"}],staticClass:"form-control",attrs:{id:"password",name:"password",type:"password"},domProps:{value:t.credential.password},on:{input:function(a){a.target.composing||(t.credential.password=a.target.value)}}})])])]),e("button",{staticClass:"btn btn-default pull-right",attrs:{id:"confirm"},on:{click:function(a){t.login(t.credential)}}},[t._v("确定")]),e("div",{directives:[{name:"show",rawName:"v-show",value:""!==t.loginErr,expression:"loginErr!==''"}],staticClass:"well"},[e("span",[t._v(t._s(t.loginErr))])]),e("br"),e("br"),e("div",{staticClass:"panel panel-default"},[t._m(0),e("div",{staticClass:"panel-body"},[t._v('微信扫描二维码可打开"似水流年小相册"小程序版，查看首页说明获取用户名、密码')]),e("img",{staticClass:"img-responsive",attrs:{src:t.qrcode}})])])},n=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"panel-heading"},[e("div",{staticClass:"panel-title"},[t._v("小程序")])])}],s={render:i,staticRenderFns:n};a.a=s},gOGN:function(t,a,e){"use strict";function i(t){e("12qG")}var n=e("mA5G"),s=e("4aQm"),o=e("VU/8"),r=i,c=o(n.a,s.a,r,"data-v-aa7d0ade",null);a.a=c.exports},isYl:function(t,a,e){"use strict";var i=e("NYxO"),n=e("rdLu"),s=e.n(n),o=e("afmS");a.a={data:function(){return{listReady:!1}},components:{VueAplayer:o.a},methods:s.a.extend({},e.i(i.b)(["getAlbumsList"]),{gotoAlbum:function(t){this.$router.push("/album?id="+t)}}),created:function(){this.getAlbumsList(this)},computed:e.i(i.a)({user:"getUser",albumsList:"getList"})}},mA5G:function(t,a,e){"use strict";var i=e("NYxO"),n=e("rdLu"),s=e.n(n),o=e("afmS");a.a={data:function(){return{albumReady:!1}},components:{VueAplayer:o.a},methods:s.a.extend({},e.i(i.b)(["getAlbum"]),{}),created:function(){this.getAlbum(this)},computed:e.i(i.a)({album:"getAlbumItem"})}},"nKb+":function(t,a,e){"use strict";var i=e("NYxO");a.a={methods:e.i(i.b)(["login"]),computed:e.i(i.a)({loginErr:"getLoginErr"}),data:function(){return{qrcode:"http://image-public.wowge.org/weshot_code_20170709.jpg",credential:{nickName:"",password:""}}}}},wTe3:function(t,a){},xJD8:function(t,a,e){"use strict";var i=e("xJsL"),n=e("6LXs"),s=e("gOGN"),o=e("YtJ0"),r=e("NYxO");a.a={store:o.a,components:{LoginComp:i.a,AlbumsListComp:n.a,AlbumComp:s.a},data:function(){return{alert:!1}},computed:e.i(r.a)({title:"getTitle",user:"getUser"}),methods:{isLoginPath:function(){if("/login"===this.$route.path)return!0},isLoggedIn:function(){var t=window.localStorage["weshot-token"];if(t){var a=JSON.parse(window.atob(t.split(".")[1]));return Date.now()/1e3<a.exp}return!1},logout:function(){window.localStorage.removeItem("weshot-token"),this.$router.push("/login")},showAlert:function(){this.alert=!0},clearAlert:function(){this.alert=!1},gotoLogin:function(){this.$router.push("/login")}}}},xJsL:function(t,a,e){"use strict";function i(t){e("wTe3")}var n=e("nKb+"),s=e("gBXN"),o=e("VU/8"),r=i,c=o(n.a,s.a,r,"data-v-3568de8b",null);a.a=c.exports},zUKl:function(t,a){}},["NHnr"]);
//# sourceMappingURL=app.2d249185c0601d1a726e.js.map